<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="theme-color" content="#1e40af">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="manifest" href="manifest.json">
<title>GMAO BAHIA v8.5</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="login-page" id="loginPage">
<div class="login-header"><div class="login-logo">ğŸ­</div><h1>GMAO BAHIA</h1><p>v8.5 - Push Notifications</p></div>
<div class="login-card">
<h2>Connexion</h2>
<div class="login-error" id="loginError"></div>
<div class="form-group"><label>Identifiant</label><div class="input-box"><span class="icon">ğŸ‘¤</span><input type="text" id="loginUser" placeholder="Identifiant"></div></div>
<div class="form-group"><label>Mot de passe</label><div class="input-box"><span class="icon">ğŸ”’</span><input type="password" id="loginPass" placeholder="Mot de passe"></div></div>
<button class="btn-login" id="btnLogin">ğŸš€ Connexion</button>
</div>
</div>
<div class="app" id="mainApp">
<header class="header">
<div class="header-top">
<div class="header-user"><div class="avatar" id="userAvatar">A</div><div class="user-info"><h1 id="userName">Utilisateur</h1><div class="role" id="userRole">-</div></div></div>
<div class="header-actions">
<button class="header-btn" id="btnNotif" onclick="toggleNotifications()" style="position:relative">ğŸ””<span class="notif-badge" id="notifBadge" style="position:absolute;top:-5px;right:-5px">0</span></button>
<button class="header-btn" id="btnRefresh">ğŸ”„</button>
<button class="header-btn danger" id="btnLogout">ğŸšª</button>
</div>
</div>
<div class="status-bar"><div class="status-dot" id="statusDot"></div><span id="statusText">Connexion...</span></div>
</header>
<!-- Panel Notifications -->
<div class="notif-panel" id="notifPanel">
<div class="notif-header">
<h3>ğŸ”” Notifications</h3>
<button class="btn btn-secondary" style="padding:8px 12px;font-size:12px" onclick="clearNotifications()">Tout effacer</button>
</div>
<div id="pushNotifBanner" class="push-banner">
<div style="flex:1">
<div style="font-weight:600;font-size:13px">ğŸ“± Notifications Push</div>
<div style="font-size:11px;color:var(--gray-500)">Recevoir les alertes mÃªme app fermÃ©e</div>
</div>
<button class="btn btn-primary" style="padding:8px 16px;font-size:12px" id="btnEnablePush" onclick="requestPushPermission()">Activer</button>
</div>
<div id="notifList"><div class="list-empty" style="padding:30px"><div class="empty-icon" style="font-size:40px">ğŸ”•</div>Aucune notification</div></div>
</div>
<div class="page active" id="pageHome">
<h2 class="page-title">ğŸ“Š Tableau de bord</h2>
<div class="stats-grid">
<div class="stat-card"><div class="stat-value" id="statDI">0</div><div class="stat-label">DI en attente</div></div>
<div class="stat-card success"><div class="stat-value" id="statBT">0</div><div class="stat-label">BT en cours</div></div>
<div class="stat-card warning"><div class="stat-value" id="statTermine">0</div><div class="stat-label">Ã€ valider</div></div>
<div class="stat-card danger"><div class="stat-value" id="statRetard">0</div><div class="stat-label">En retard</div></div>
</div>
<div class="card" style="margin-top:16px">
<div class="card-header"><div class="card-icon blue">ğŸ“ˆ</div><div class="card-title">Indicateurs Performance</div></div>
<div class="stats-grid" style="grid-template-columns:1fr 1fr;margin-top:12px">
<div class="kpi-box"><div class="kpi-value" id="kpiMTBF">--</div><div class="kpi-label">MTBF (h)</div><div class="kpi-desc">Temps moyen entre pannes</div></div>
<div class="kpi-box"><div class="kpi-value" id="kpiMTTR">--</div><div class="kpi-label">MTTR (min)</div><div class="kpi-desc">Temps moyen de rÃ©paration</div></div>
</div>
<div class="stats-grid" style="grid-template-columns:1fr 1fr;margin-top:12px">
<div class="kpi-box"><div class="kpi-value" id="kpiDispo">--</div><div class="kpi-label">DisponibilitÃ© %</div><div class="kpi-desc">MTBF/(MTBF+MTTR)</div></div>
<div class="kpi-box"><div class="kpi-value" id="kpiNbPannes">0</div><div class="kpi-label">Pannes (30j)</div><div class="kpi-desc">Nombre total</div></div>
</div>
</div>
<div class="card" style="margin-top:16px">
<div class="card-header"><div class="card-icon orange">ğŸ“‹</div><div class="card-title">ActivitÃ© rÃ©cente</div></div>
<div id="recentActivity" style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
<div><div style="font-weight:700;color:var(--danger);margin-bottom:8px;font-size:13px">ğŸš¨ DI</div><div id="recentDIList"><div class="list-empty" style="padding:20px"><div class="empty-icon" style="font-size:32px">ğŸ“­</div>Aucune DI</div></div></div>
<div><div style="font-weight:700;color:var(--warning);margin-bottom:8px;font-size:13px">ğŸ“„ BT</div><div id="recentBTList"><div class="list-empty" style="padding:20px"><div class="empty-icon" style="font-size:32px">ğŸ“­</div>Aucun BT</div></div></div>
</div>
</div>
</div>
<div class="page" id="pageSignal">
<h2 class="page-title">ğŸš¨ Signalement</h2>
<div class="tabs"><button class="tab-btn active" data-tab="new">â• Nouveau</button><button class="tab-btn" data-tab="history">ğŸ“œ Mes DI<span class="tab-badge" id="myDICount">0</span></button></div>
<div class="tab-content active" id="tabSignalNew">
<div class="card"><div class="card-header"><div class="card-icon purple">ğŸ•</div><div class="card-title">Horaires</div></div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
<div><label class="form-label">Heure signalement *</label><div style="display:flex;gap:8px"><input type="time" class="form-input" id="heureSignal" style="flex:1;font-size:18px;text-align:center;padding:14px"><button type="button" class="btn btn-secondary" onclick="setCurrentTime('heureSignal')" style="padding:14px">â±ï¸</button></div></div>
<div><label class="form-label">ArrivÃ©e maintenance</label><div style="display:flex;gap:8px"><input type="time" class="form-input" id="heureFinOp" style="flex:1;font-size:18px;text-align:center;padding:14px"><button type="button" class="btn btn-secondary" onclick="setCurrentTime('heureFinOp')" style="padding:14px">â±ï¸</button></div></div>
</div>
</div>
<div class="card" id="step1"><div class="card-header"><div class="card-icon blue">1ï¸âƒ£</div><div class="card-title">OpÃ©rateur</div></div><div style="background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;padding:14px 18px;border-radius:14px;display:flex;align-items:center;gap:12px"><span style="font-size:28px">ğŸ‘¤</span><div><div style="font-weight:700" id="opName">-</div><div style="font-size:13px;opacity:.9">OpÃ©rateur</div></div></div></div>
<div class="card" id="step2"><div class="card-header"><div class="card-icon blue">2ï¸âƒ£</div><div class="card-title">Ligne</div></div><div class="chips" id="lignesChips"></div></div>
<div class="card hidden" id="step3"><div class="card-header"><div class="card-icon blue">3ï¸âƒ£</div><div class="card-title">Machine</div></div><div class="chips" id="machinesChips"></div></div>
<div class="card hidden" id="step4"><div class="card-header"><div class="card-icon blue">4ï¸âƒ£</div><div class="card-title">Zone</div></div><div class="chips" id="zonesChips"></div></div>
<div class="card hidden" id="step5"><div class="card-header"><div class="card-icon blue">5ï¸âƒ£</div><div class="card-title">Composant</div></div><div class="chips" id="composantsChips"></div></div>
<div class="card hidden" id="step6"><div class="card-header"><div class="card-icon red">6ï¸âƒ£</div><div class="card-title">Anomalie</div></div><div class="chips" id="anomaliesChips"></div></div>
<div class="card hidden" id="step7"><div class="card-header"><div class="card-icon purple">7ï¸âƒ£</div><div class="card-title">Description standardisÃ©e</div></div><select class="form-select" id="descriptionSelect"><option value="">-- SÃ©lectionner --</option></select></div>
<div class="card hidden" id="step8"><div class="card-header"><div class="card-icon orange">8ï¸âƒ£</div><div class="card-title">Techniciens</div></div><div id="techsContainer"></div></div>
<div class="card hidden" id="step9"><div class="card-header"><div class="card-icon green">9ï¸âƒ£</div><div class="card-title">Commentaire</div></div><textarea class="form-textarea" id="commentInput" placeholder="Commentaire libre..."></textarea></div>
<div class="card hidden" id="step10"><div class="card-header"><div class="card-icon blue">ğŸ“·</div><div class="card-title">Photo (optionnel)</div></div><div class="photo-upload"><input type="file" id="photoInput" accept="image/*" capture="environment" style="display:none"><button class="photo-btn" id="btnTakePhoto">ğŸ“· Prendre photo</button><div class="photo-preview hidden" id="photoPreview"><img id="photoImg" src=""><button class="photo-remove" id="btnRemovePhoto">âœ•</button></div></div></div>
<div class="card hidden" id="previewCard"><div class="card-header"><div class="card-icon orange">ğŸ‘ï¸</div><div class="card-title">AperÃ§u</div></div><div class="preview-box" id="previewBox"></div></div>
<div class="success-box hidden" id="successBox"><div class="success-icon">âœ…</div><h3>DI EnregistrÃ©e!</h3><p>Envoyez WhatsApp maintenant</p><div class="success-id" id="successId">DI-XXXXXX-X</div></div>
</div>
<div class="tab-content" id="tabSignalHistory"><div id="myDIList"><div class="list-empty"><div class="empty-icon">ğŸ“­</div>Aucun signalement</div></div></div>
</div>
<div class="page" id="pageMaint">
<h2 class="page-title">ğŸ”§ Maintenance</h2>
<div class="tabs">
<button class="tab-btn active" data-tab="di">ğŸ“‹ DI Ã  traiter <span class="tab-badge" id="diWaitingCount">0</span></button>
<button class="tab-btn" data-tab="bt">ğŸ“„ Bons de Travail <span class="tab-badge" id="btCount">0</span></button>
</div>
<div class="tab-content active" id="tabMaintDI"><div id="diWaitingList"><div class="list-empty"><div class="empty-icon">âœ…</div>Aucune DI</div></div></div>
<div class="tab-content" id="tabMaintBT"><div class="search-box"><span class="search-icon">ğŸ”</span><input type="text" id="searchBT" placeholder="Rechercher BT..."></div><div id="btList"><div class="list-empty"><div class="empty-icon">ğŸ“­</div>Aucun BT</div></div></div>
</div>
<div class="page" id="pageHistorique">
<h2 class="page-title">ğŸ“‹ Historique</h2>
<div class="tabs">
<button class="tab-btn active" data-tab="histDI">ğŸ“ DI</button>
<button class="tab-btn" data-tab="histBT">ğŸ“„ BT</button>
</div>
<div class="tab-content active" id="tabHistDI"><div class="search-box"><span class="search-icon">ğŸ”</span><input type="text" id="searchHistDI" placeholder="Rechercher..."></div><div id="histDIList"><div class="list-empty"><div class="empty-icon">ğŸ“­</div>Aucune DI</div></div></div>
<div class="tab-content" id="tabHistBT"><div class="search-box"><span class="search-icon">ğŸ”</span><input type="text" id="searchHistBT" placeholder="Rechercher..."></div><div id="histBTList"><div class="list-empty"><div class="empty-icon">ğŸ“­</div>Aucun BT</div></div></div>
</div>
<div class="page" id="pageValidation">
<h2 class="page-title">âœ”ï¸ Validation BT</h2>
<div id="btToValidateList"><div class="list-empty"><div class="empty-icon">âœ…</div>Aucun BT Ã  valider</div></div>
</div>
<nav class="bottom-nav" id="bottomNav">
<button class="nav-btn active" data-page="pageHome"><span class="nav-icon">ğŸ </span><span>Accueil</span></button>
<button class="nav-btn" data-page="pageSignal" id="navSignal"><span class="nav-icon">ğŸš¨</span><span>Signaler</span></button>
<button class="nav-btn" data-page="pageMaint" id="navMaint"><span class="nav-icon">ğŸ”§</span><span>Maintenance</span><span class="notif-badge" id="navMaintBadge">0</span></button>
<button class="nav-btn" data-page="pageHistorique" id="navHistorique"><span class="nav-icon">ğŸ“‹</span><span>Historique</span></button>
<button class="nav-btn" data-page="pageValidation" id="navValidation"><span class="nav-icon">âœ”ï¸</span><span>Valider</span><span class="notif-badge" id="navValidBadge">0</span></button>
</nav>
<div class="action-bar" id="signalActionBar"><div class="action-buttons"><button class="btn btn-primary" id="btnSaveDI" disabled>ğŸ’¾ Enregistrer</button><button class="btn btn-whatsapp" id="btnWhatsApp" disabled>ğŸ“±</button></div></div>
</div>
<div class="modal" id="modalTraitement">
<div class="modal-content">
<div class="modal-header"><h3>ğŸ”§ Traiter DI</h3><button class="modal-close" onclick="closeModal('modalTraitement')">âœ•</button></div>
<div class="di-card" id="modalDIInfo"></div>
<div class="form-group"><label class="form-label">Cause *</label><select class="form-select" id="traitCause"><option value="">-- SÃ©lectionner --</option><option>Usure normale</option><option>DÃ©faut matÃ©riel</option><option>Erreur opÃ©rateur</option><option>Manque maintenance</option><option>Autre</option></select></div>
<div class="form-group"><label class="form-label">Diagnostic *</label><textarea class="form-textarea" id="traitDiag" placeholder="Diagnostic..."></textarea></div>
<div class="form-group"><label class="form-label">Type action *</label><select class="form-select" id="traitAction"><option value="">-- SÃ©lectionner --</option><option>Correctif</option><option>PrÃ©ventif</option><option>AmÃ©lioratif</option></select></div>
<div class="form-group"><label class="form-label">DÃ©tail action *</label><textarea class="form-textarea" id="traitDetail" placeholder="Action rÃ©alisÃ©e..."></textarea></div>
<div class="form-group"><label class="form-label">PiÃ¨ces utilisÃ©es</label><textarea class="form-textarea" id="traitPieces" placeholder="Ex: Joint torique x2, Roulement SKF 6205..."></textarea></div>
<button class="btn btn-success" style="width:100%;margin-top:16px" id="btnCloseDI">âœ… ClÃ´turer et GÃ©nÃ©rer BT</button>
</div>
</div>
<div class="modal" id="modalStatutBT">
<div class="modal-content">
<div class="modal-header"><h3>ğŸ“Š Changer Statut</h3><button class="modal-close" onclick="closeModal('modalStatutBT')">âœ•</button></div>
<div class="bt-card" id="modalStatutBTInfo"></div>
<div class="statut-workflow"><div class="statut-title">Workflow:</div><div class="statut-steps"><div class="statut-step" data-statut="En cours">ğŸ”§ En cours</div><div class="statut-arrow">â†’</div><div class="statut-step" data-statut="En attente piÃ¨ces">ğŸ“¦ Attente</div><div class="statut-arrow">â†’</div><div class="statut-step" data-statut="TerminÃ©">âœ… TerminÃ©</div><div class="statut-arrow">â†’</div><div class="statut-step" data-statut="ValidÃ©">âœ”ï¸ ValidÃ©</div></div></div>
<div class="form-group"><label class="form-label">Nouveau statut</label><select class="form-select" id="selectNewStatut" onchange="onStatutChange()"></select></div>
<div id="horairesIntervention" class="card" style="background:var(--gray-50);display:none;margin:16px 0">
<div class="card-header" style="margin-bottom:12px"><div class="card-icon purple">ğŸ•</div><div class="card-title">Horaires Intervention</div></div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
<div><label class="form-label">Heure arrivÃ©e *</label><div style="display:flex;gap:8px"><input type="time" class="form-input" id="btHeureArrivee" style="flex:1"><button type="button" class="btn btn-secondary" onclick="setCurrentTime('btHeureArrivee')" style="padding:12px">â±ï¸</button></div></div>
<div><label class="form-label">Heure fin *</label><div style="display:flex;gap:8px"><input type="time" class="form-input" id="btHeureFin" style="flex:1"><button type="button" class="btn btn-secondary" onclick="setCurrentTime('btHeureFin')" style="padding:12px">â±ï¸</button></div></div>
</div>
</div>
<div class="form-group"><label class="form-label">Commentaire</label><textarea class="form-textarea" id="statutComment" placeholder="Optionnel..."></textarea></div>
<div class="validation-info" id="validationInfo">âš ï¸ Validation rÃ©servÃ©e au <strong>Chef d'Ã©quipe</strong></div>
<button class="btn btn-success" style="width:100%;margin-top:16px" id="btnSaveStatut">ğŸ’¾ Valider</button>
</div>
</div>
<div class="modal" id="modalBT">
<div class="modal-content">
<div class="modal-header"><h3>ğŸ“„ DÃ©tail BT</h3><button class="modal-close" onclick="closeModal('modalBT')">âœ•</button></div>
<div id="modalBTContent"></div>
</div>
</div>
<div class="modal" id="modalDI">
<div class="modal-content">
<div class="modal-header"><h3>ğŸ“‹ DÃ©tail DI</h3><button class="modal-close" onclick="closeModal('modalDI')">âœ•</button></div>
<div id="modalDIContent"></div>
</div>
</div>
<div class="modal" id="modalEditDI">
<div class="modal-content">
<div class="modal-header"><h3>âœï¸ Modifier DI</h3><button class="modal-close" onclick="closeModal('modalEditDI')">âœ•</button></div>
<div class="form-group"><label class="form-label">Ligne</label><select class="form-select" id="editDILigne"></select></div>
<div class="form-group"><label class="form-label">Machine</label><select class="form-select" id="editDIMachine"></select></div>
<div class="form-group"><label class="form-label">Zone</label><select class="form-select" id="editDIZone"></select></div>
<div class="form-group"><label class="form-label">Composant</label><select class="form-select" id="editDIComposant"></select></div>
<div class="form-group"><label class="form-label">Anomalie</label><select class="form-select" id="editDIAnomalie"></select></div>
<div class="form-group"><label class="form-label">Commentaire</label><textarea class="form-textarea" id="editDIComment" placeholder="Commentaire..."></textarea></div>
<button class="btn btn-primary" style="width:100%;margin-top:16px" onclick="saveEditDI()">ğŸ’¾ Sauvegarder</button>
</div>
</div>
<div class="modal" id="modalEditBT">
<div class="modal-content">
<div class="modal-header"><h3>âœï¸ Modifier BT</h3><button class="modal-close" onclick="closeModal('modalEditBT')">âœ•</button></div>
<div class="bt-card" id="editBTInfo"></div>
<div class="form-group"><label class="form-label">Cause</label><select class="form-select" id="editBTCause"><option value="">-- SÃ©lectionner --</option><option>Usure normale</option><option>DÃ©faut matÃ©riel</option><option>Erreur opÃ©rateur</option><option>Manque maintenance</option><option>Autre</option></select></div>
<div class="form-group"><label class="form-label">Diagnostic</label><textarea class="form-textarea" id="editBTDiag" placeholder="Diagnostic..."></textarea></div>
<div class="form-group"><label class="form-label">Type action</label><select class="form-select" id="editBTAction"><option value="">-- SÃ©lectionner --</option><option>Correctif</option><option>PrÃ©ventif</option><option>AmÃ©lioratif</option></select></div>
<div class="form-group"><label class="form-label">DÃ©tail action</label><textarea class="form-textarea" id="editBTDetail" placeholder="Action rÃ©alisÃ©e..."></textarea></div>
<div class="form-group"><label class="form-label">PiÃ¨ces utilisÃ©es</label><textarea class="form-textarea" id="editBTPieces" placeholder="Ex: Joint torique x2..."></textarea></div>
<button class="btn btn-primary" style="width:100%;margin-top:16px" onclick="saveEditBT()">ğŸ’¾ Sauvegarder</button>
</div>
</div>
<div class="toast" id="toast"></div>
<script src="js/app.js"></script>
</body>
</html>